import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./VssPersona.css";import*as React from"react";import{css}from"../../Util";import{getColorString}from"../../Utilities/Color";import{getInitialsColorFromName,getInitialsFromName}from"./VssPersona.Initials";import{Icon}from"../../Icon";import{Tooltip}from"../../TooltipEx";var VssPersona=function(e){function t(t){var r=e.call(this,t)||this;return r.setTargetElement=function(e){r.targetElement=e},r.onImageError=function(e){r.props.showInitialsOnImageError?r.setState({imageError:!0}):r.props.onImageError&&r.props.onImageError(e)},r.handleKeyDown=function(e){13!==e.keyCode&&32!==e.keyCode||r.showPersonaCard()},r.showPersonaCard=function(){r.props.suppressPersonaCard||r.setState({showPersonaCard:!0})},r.hidePersonaCard=function(){r.setState({showPersonaCard:!1})},r.state={imageError:!1,showPersonaCard:!1,imageUrlVal:r._getImageUrl(t)},r}return tslib_1.__extends(t,e),t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.setState({showPersonaCard:!1,imageUrlVal:this._getImageUrl(e)})},t.prototype.shouldComponentUpdate=function(e,t){return!(e.identityDetailsProvider||this.props.imageUrl===e.imageUrl&&this.props.displayName===e.displayName)||!(!this.props.identityDetailsProvider&&!e.identityDetailsProvider)&&(!this.props.identityDetailsProvider||!e.identityDetailsProvider||(this.props.size!==e.size||this.props.cssClass!==e.cssClass||this.props.identityDetailsProvider!==e.identityDetailsProvider||this.state.showPersonaCard!==t.showPersonaCard))},t.prototype.render=function(){var e=this.props,t=e.ariaLabel,r=e.identityDetailsProvider,s=e.size,a=void 0===s?"medium":s,o=e.imgAltText,i=void 0===o?"":o,n=e.imageUrl,l=e.displayName,m=r?this.state.imageUrlVal:n,p={};this.props.dataIsFocusable&&(p["data-is-focusable"]=!0),this.props.isTabStop&&(p.tabIndex=0),this.props.suppressPersonaCard||(p["aria-expanded"]=this.state.showPersonaCard,p.onKeyDown=this.handleKeyDown,p.onClick=this.showPersonaCard);var d=r?r.getDisplayName():l;void 0===t?d&&(p["aria-label"]=d):t?p["aria-label"]=t:p["aria-hidden"]="true";var c=void 0===d?void 0:getInitialsColorFromName(d),h=void 0===m||this.state.imageError?React.createElement("div",{className:css("vss-Persona-content",a),style:c&&{background:getColorString(c)}},d?React.createElement("span",null,getInitialsFromName(d)):React.createElement(Icon,{iconName:"Contact"})):React.createElement("img",{className:"vss-Persona-content using-image",src:m,alt:i,onError:this.onImageError});return React.createElement(React.Fragment,null,React.createElement(Tooltip,{text:l,showOnFocus:!0},React.createElement("div",tslib_1.__assign({className:css("vss-Persona flex-noshrink",this.props.className,this.props.cssClass,a),ref:this.setTargetElement},p),h)),!this.props.suppressPersonaCard&&this.state.showPersonaCard&&r&&r.onRenderPersonaCard&&r.onRenderPersonaCard(this.targetElement,this.hidePersonaCard))},t.prototype._getImageUrl=function(e){var t=e.identityDetailsProvider,r=e.size,s=void 0===r?"medium":r,a=this._getSize(s);return t&&t.getIdentityImageUrl(a)},t.prototype._getSize=function(e){switch(e){case"extra-extra-small":return 16;case"extra-small":return 18;case"extra-small-plus":return 20;case"small":return 24;case"small-plus":return 28;case"medium":return 32;case"medium-plus":return 40;default:case"large":return 48;case"extra-large":return 72;case"extra-extra-large":return 100}},t}(React.Component);export{VssPersona};