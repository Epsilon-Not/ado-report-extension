import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{FilterBarItem}from"../../FilterBarItem";import{ListSelection}from"../../List";import{getListBoxItemsValue,wrapListBoxItems}from"../../ListBox";import{SelectionObserver}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{css}from"../../Util";import{updateFilterToSelection}from"../../Utilities/DropdownFilter";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{compareSelectionRanges}from"../../Utilities/Selection";import{Dropdown}from"./Dropdown";import{DropdownExpandableButton}from"./DropdownExpandableButton";var DropdownFilterBarItemWidth=256,DropdownFilterBarItem=function(e){function t(t){var o=e.call(this,t)||this;return o.dropdown=React.createRef(),o.onFilterChanged=function(t){e.prototype.onFilterChanged.call(o,t);var r=getListBoxItemsValue(o.wrappedItems||o.props.items);if(t&&t.value){for(var i=new ListSelection(o.selection.multiSelect),n=function(e){var o=r.findIndex(function(o){return o.id===t.value[e]||o.data===t.value[e]});o>-1&&i.select(o,1,!0)},l=0;l<t.value.length;l++)n(l);compareSelectionRanges(o.selection.value,i.value).length&&(o.selection.value=i.value)}else o.selection.clear()},o.onSelectionChanged=function(e){var t=getListBoxItemsValue(o.wrappedItems||o.props.items);return o.props.filter&&updateFilterToSelection(e,t,o.props.filter,o.props.filterItemKey),!0},o.renderExpandableButton=function(e){var t=o.props,r=t.className,i=t.renderExpandable,n=tslib_1.__assign({},e,{className:css(r,"bolt-dropdown-filter-bar-item"),subtle:!0,renderSelectedItems:o.renderSelectedItems});return i?i(n):React.createElement(DropdownExpandableButton,tslib_1.__assign({},n))},o.onClearClick=function(){o.selection.clear(),Utils_Accessibility.announce(Resources.AnnounceFilterCleared)},o.renderSelectedItems=function(e,t){var r=t[e.value[0].beginIndex].text||"";e.selectedCount>1&&(r=r+" (+"+(e.selectedCount-1)+")");var i=React.createElement("span",{className:"bolt-dropdown-filter-bar-item-selected-text"},r);return o.props.showPlaceholderAsLabel?React.createElement(React.Fragment,null,React.createElement("span",{className:"bolt-dropdown-filter-bar-item-placeholder"},o.props.placeholder+": "),i):i},o.selection=t.selection||new DropdownSelection,o.wrappedItems=wrapListBoxItems(t.items),o}return tslib_1.__extends(t,e),t.prototype.focus=function(){this.dropdown.current&&this.dropdown.current.focus()},t.prototype.componentDidMount=function(){if(e.prototype.componentDidMount.call(this),this.props.filter){var t=this.props.filter.getFilterItemState(this.props.filterItemKey);if(t&&t.value){for(var o=getListBoxItemsValue(this.wrappedItems||this.props.items),r=new ListSelection(this.selection.multiSelect),i=function(e){var i=o.findIndex(function(o){return o.id===t.value[e]||o.data===t.value[e]});i>-1&&r.select(i,1,!0)},n=0;n<t.value.length;n++)i(n);this.selection.value=r.value}}},t.prototype.render=function(){var e=this;return React.createElement(SelectionObserver,{selection:this.selection,onSelectionChanged:this.onSelectionChanged},function(){var t=ObservableLike.getValue(e.props.actions||[]).slice();return e.props.hideClearAction||t.push({className:"bolt-dropdown-action-right-button",disabled:0===e.selection.selectedCount,iconProps:{iconName:"Clear"},text:Resources.DropdownClearActionText,onClick:e.onClearClick}),React.createElement(Dropdown,tslib_1.__assign({renderExpandable:e.renderExpandableButton,width:DropdownFilterBarItemWidth},e.props,{actions:t,selection:e.selection,ref:e.dropdown}))})},t}(FilterBarItem);export{DropdownFilterBarItem};