function updateFilteredItems(e,t){var r=t.filteredSelection,n=t.filterText,l=[],i=getListBoxItemsValue(t.wrappedItems||e.items),o=i;if(e.userFilteredItems){o=getItemsValue(e.userFilteredItems);var s=e.userFilteredItemsIndexMap&&e.userFilteredItemsIndexMap.value;if(s)l=s;else for(var a=function(e){var t=i.findIndex(function(t){return t.id===o[e].id});$DEBUG&&-1===t&&console.error("filteredItems contains an item not in items. Selection cannot be maintained unless filteredItems is a subset of items. Check item in filteredItems at index "+e),l.push(t)},d=0;d<e.userFilteredItems.length;d++)a(d)}if(e.filterByText&&n.value){var c=filterItems(o,n.value,l,e.filterItem);o=c.filteredItems,l=c.filteredIndexMap}for(;o.length&&3===o[0].type;)o.shift(),l.shift();if(n.value){var p=Resources.NoFilterResults;e.filteredNoResultsText&&(p=ObservableLike.getValue(e.filteredNoResultsText)),Utils_Accessibility.announce(o.length>0?format(Resources.AnnounceFilterResultCount,o.length):p,!0)}else 0===o.length&&e.noItemsText&&Utils_Accessibility.announce(e.noItemsText,!0);return t.filteredItems.value=o,r.updateFilteredSelection(l),!0}import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableArray,ObservableLike,ObservableValue}from"../../Core/Observable";import{TimerManagement}from"../../Core/TimerManagement";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{FilteredListSelection,renderListCell}from"../../List";import{getListBoxItemsValue,getUnselectableRanges,wrapListBoxItems}from"../../ListBox";import{ItemsObserver,Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{SimpleTableCell}from"../../Table";import{css}from"../../Util";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{getItemsValue}from"../../Utilities/Provider";import{DropdownCallout}from"./DropdownCallout";import{DropdownExpandableTextField}from"./DropdownExpandableTextField";var Dropdown=function(e){function t(t){var r=e.call(this,t)||this;r.expandable=React.createRef(),r.expandableContainer=React.createRef(),r.filterText=new ObservableValue(""),r.collapse=function(){r.expandable.current&&r.expandable.current.collapse()},r.expand=function(){r.expandable.current&&r.expandable.current.expand()},r.onDismiss=function(){r.expandable.current&&r.expandable.current.collapse()},r.onExpand=function(){r.props.onExpand&&r.props.onExpand(),r.updateFilteredItems()},r.onActivate=function(e,t){e.defaultPrevented||"keydown"!==e.type||(r.state.filteredSelection.multiSelect?r.state.filteredSelection.toggle(r.state.filteredItems.value.indexOf(t),r.state.filteredSelection.alwaysMerge):r.state.filteredSelection.select(r.state.filteredItems.value.indexOf(t),1,r.state.filteredSelection.alwaysMerge),r.onSelect(e,t))},r.onFilterTextChanged=function(e,t){r.filterText.value=t,r.updateFilteredItems()},r.onSelect=function(e,t){var n=r.props,l=n.dismissOnSelect,i=n.onSelect,o=r.parentSelection;i&&i(e,t),(void 0!==l?l:o.value.length>0&&!o.multiSelect&&!o.selectOnFocus)&&r.onDismiss()},r.selectionChanged=function(e,t){return r.state.filteredSelection.selectionChanged(e,t),!0},r.renderCallout=function(e,t,n,l,i,o,s){var a=r.props,d=a.actions,c=a.calloutContentClassName,p=a.containerClassName,m=a.filterPlaceholderText,u=a.filteredNoResultsText,f=a.getUnselectableRanges,x=a.items,b=a.loading,h=a.noItemsText,I=a.renderItem,g=a.searching,v=a.showFilterBox,C=a.userFilteredItems,T=r.props.width;void 0===T&&r.expandableContainer.current&&(T=r.expandableContainer.current.clientWidth);var w=r.state,S=w.filteredItems,F=w.filterText,y={actions:d,anchorElement:n,anchorOffset:l,anchorOrigin:i,anchorPoint:o,calloutContentClassName:c,containerClassName:p,dropdownOrigin:s,filteredItems:S,filteredNoResultsText:u,selection:w.filteredSelection,filterPlaceholderText:m,filterText:F,getUnselectableRanges:f,id:t,items:x,loading:b,noItemsText:h,onActivate:r.onActivate,onFilterTextChanged:r.onFilterTextChanged,onDismiss:r.onDismiss,onSelect:r.onSelect,renderItem:I,searching:g,showFilterBox:v,updateFilteredItems:r.updateFilteredItems,userFilteredItems:C,width:T};return r.props.renderCallout(y)},r.updateFilteredItems=function(){return r.debouncedUpdateFilteredItems(),!0},r.debouncedUpdateFilteredItems=function(){updateFilteredItems(r.props,r.state)},r.parentSelection=t.selection||new DropdownSelection;var n=wrapListBoxItems(t.items),l=getListBoxItemsValue(n||t.items);return r.timerManagement=new TimerManagement,r.state={filteredItems:new ObservableArray(l.slice()),filteredSelection:new FilteredListSelection(r.parentSelection),filterText:r.filterText,props:t,wrappedItems:n},r}return tslib_1.__extends(t,e),t.getDerivedStateFromProps=function(e,t){return e.userFilteredItems===t.props.userFilteredItems&&e.items===t.props.items||updateFilteredItems(e,t),tslib_1.__assign({},t,{props:e,wrappedItems:wrapListBoxItems(e.items)})},t.prototype.componentDidMount=function(){this.props.filterThrottleWait&&(this.debouncedUpdateFilteredItems=this.timerManagement.debounce(this.debouncedUpdateFilteredItems,this.props.filterThrottleWait))},t.prototype.render=function(){var e=this,t=this.props,r=t.ariaLabel,n=t.className,l=t.disabled,i=t.items,o=t.placeholder,s=t.onCollapse,a=t.renderExpandable,d=t.renderSelectedItems,c={observableValue:this.parentSelection,filter:this.selectionChanged};return React.createElement(ItemsObserver,{getUnselectableRanges:this.props.getUnselectableRanges,items:i,selection:this.parentSelection},React.createElement(Observer,{selection:c},function(){return a({ariaLabel:r,className:css(n,"bolt-dropdown-expandable"),containerRef:e.expandableContainer,disabled:l,placeholder:o,onCollapse:s,onExpand:e.onExpand,expandableRef:e.expandable,renderCallout:e.renderCallout,items:getListBoxItemsValue(e.state.wrappedItems||i),renderSelectedItems:d,selection:e.parentSelection})}))},t.prototype.focus=function(){this.expandable.current&&this.expandable.current.focus()},t.defaultProps={filterByText:!0,filterItem:filterItemByText,getUnselectableRanges:getUnselectableRanges,renderCallout:DropdownCallout,renderExpandable:DropdownExpandableTextField,renderSelectedItems:renderDropdownSelectedItemText},t}(React.Component);export{Dropdown};export function filterItemByText(e,t){return!(!t.text||2===t.type||3===t.type||4===t.type)&&-1!==t.text.toLowerCase().indexOf(e.toLowerCase())};export function renderDropdownSelectedItemText(e,t){var r=t[e.value[0].beginIndex],n=r&&r.text||"";return e.selectedCount>1&&(n=n+" (+"+(e.selectedCount-1)+")"),n};export function filterItems(e,t,r,n){void 0===r&&(r=[]),void 0===n&&(n=filterItemByText);var l=[],i=[],o=[];if(t)for(var s=void 0,a=-1,d=void 0,c=-1,p=0,m=e.length;p<m;p++){var u=e[p],f=r.length?r[p]:p;if(2===u.type)s=u,a=f;else if(3===u.type)d=u,c=f;else{var x=n(t,u,e);(x||4===u.type)&&(d&&d.groupId===u.groupId&&(l.push(d),i.push(c),d=void 0),s&&s.groupId===u.groupId&&(l.push(s),i.push(a),s=void 0),l.push(u),i.push(f),o.push(Array.isArray(x)?x:[]))}}return{filteredItems:l,filteredIndexMap:i,filterMatches:o}};export function renderHighlightedText(e,t,r,n,l){var i=n;return l&&n.text&&(i=tslib_1.__assign({},n,{textNode:getHighlightedText(n.text,l)})),React.createElement(SimpleTableCell,{className:css(r.className,n.className,2===n.type&&"bolt-list-box-header"),columnIndex:t,key:t,tableColumn:r},React.createElement("div",{id:2===n.type?"header-"+n.id:void 0,"aria-label":2===n.type?format(Resources.HeaderAriaLabel,n.text):void 0},renderListCell(i)))};export function getHighlightedText(e,t){for(var r=[],n=-1,l=0;l<e.length;l++)-1!==t.indexOf(l)?r&&r[r.length-1]&&r[r.length-1].bold?r[n].text+=e.charAt(l):r[++n]={text:e.charAt(l),bold:!0}:r&&r[r.length-1]&&!r[r.length-1].bold?r[n].text+=e.charAt(l):r[++n]={text:e.charAt(l),bold:!1};for(var i=[],l=0;l<r.length;l++){var o=r[l];o.bold?i.push(React.createElement("span",{className:"font-weight-heavy",key:e+"-"+l},o.text)):i.push(o.text)}return React.createElement("span",null,i)};