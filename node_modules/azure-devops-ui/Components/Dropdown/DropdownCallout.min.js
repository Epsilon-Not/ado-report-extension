import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Callout}from"../../Callout";import{FocusZone}from"../../FocusZone";import{ListBox}from"../../ListBox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{TextField}from"../../TextField";import{css,getSafeId,preventDefault}from"../../Util";var ItemsForFilter=10,DefaultWidth=256;export function DropdownCallout(e){return React.createElement(DropdownCalloutComponent,tslib_1.__assign({},e))};var DropdownCalloutComponent=function(e){function t(t){var o=e.call(this,t)||this;return o.callout=React.createRef(),o.calloutContent=React.createRef(),o.filterBox=React.createRef(),o.initFocusElement=React.createRef(),o.updateLayout=function(){return setTimeout(function(){o.callout.current&&o.callout.current.updateLayout()},0),!0},o.onMouseDown=function(e){o.props.ignoreMouseDown&&"INPUT"!==e.target.tagName&&preventDefault(e)},o.listBoxDidUpdate=function(){o.getScrollWidth()},o.getScrollWidth=function(){window.requestAnimationFrame(function(){if(o.calloutContent.current){var e=o.calloutContent.current.offsetWidth-o.props.width;Math.abs(e)>1&&o.setState({scrollBarWidth:e+o.state.scrollBarWidth})}})},o.state={scrollBarWidth:0},o}return tslib_1.__extends(t,e),t.prototype.componentDidMount=function(){this.getScrollWidth()},t.prototype.focus=function(){this.filterBox.current?this.filterBox.current.focus():this.initFocusElement.current&&this.initFocusElement.current.focus()},t.prototype.render=function(){var e=this,t=this.props,o=t.actions,r=t.anchorElement,n=t.anchorOffset,l=t.anchorOrigin,i=t.anchorPoint,a=t.blurDismiss,s=void 0===a||a,c=t.calloutContentClassName,u=t.containerClassName,d=t.contentLocation,m=t.dropdownOrigin,f=t.excludeFocusZone,p=t.excludeTabStop,h=t.filteredItems,b=t.filteredNoResultsText,v=t.filteredResultsLoadingText,R=t.filterPlaceholderText,x=t.filterText,w=t.focusOnMount,g=t.getUnselectableRanges,C=t.id,D=(t.ignoreMouseDown,t.items),E=t.lightDismiss,F=t.listBoxClassName,N=t.listBoxRef,B=t.loading,I=t.onActivate,S=t.onFilterTextChanged,T=t.onSelect,O=t.renderBeforeContent,L=t.renderItem,y=t.searching,W=t.selection,P=t.showCloseButton,_=t.showFilterBox,M=t.title,U=t.updateFilteredItems,k=t.userFilteredItems,A=this.props.width,Z=void 0===A?DefaultWidth:A;Z>0&&(Z-=this.state.scrollBarWidth);var V="bolt-dropdown-textfield-"+C,z=function(){e.props.onDismiss&&e.props.onDismiss(),x.value="",S&&S(null,""),U&&U()};return React.createElement(Callout,{anchorElement:r,anchorOffset:n,anchorOrigin:l,anchorPoint:i,blurDismiss:s,calloutOrigin:m,contentClassName:css(c,"bolt-dropdown flex-column custom-scrollbar v-scroll-auto h-scroll-hidden"),contentLocation:d,contentRef:this.calloutContent,contentShadow:!0,contentSize:3,escDismiss:!0,id:C,lightDismiss:E,focuszoneProps:{postprocessKeyStroke:function(e){return 9!==e.which||e.defaultPrevented?1:(e.preventDefault(),z(),3)}},onDismiss:z,role:"menu",ref:this.callout},React.createElement(FocusZone,{circularNavigation:!0,defaultActiveElement:_||void 0===_&&D.length>ItemsForFilter?"#"+getSafeId(V):".bolt-dropdown-init-focus",direction:2,focusOnMount:void 0===w||w},React.createElement("div",{className:"bolt-dropdown-container no-outline",onMouseDown:this.onMouseDown,style:{width:Z}},React.createElement("div",{"aria-hidden":"true","aria-roledescription":Resources.DropdownCalloutRoleDescription,className:"bolt-dropdown-init-focus no-outline",tabIndex:p?void 0:-1,ref:this.initFocusElement,role:"menuitem"}),React.createElement(Observer,{items:{observableValue:D,filter:this.updateLayout}},function(){var t=void 0===_?D.length>ItemsForFilter:_;return t||M||P?React.createElement("div",{className:"bolt-dropdown-header-container"},(M||P)&&React.createElement("div",{className:"bolt-dropdown-header flex-row flex-center"},React.createElement("div",{className:"bolt-dropdown-header-text flex-grow font-weight-semibold"},M),P&&React.createElement(Button,{className:"bolt-dropdown-header-button",ariaLabel:Resources.Close,iconProps:{iconName:"Cancel"},onClick:z,subtle:!0})),t&&React.createElement("div",{key:"bolt-dropdown-filter-container",className:"bolt-dropdown-filter-container"},React.createElement(TextField,{key:"bolt-dropdown-filter",ariaLabel:Resources.SearchAriaLabel,className:"bolt-dropdown-filter",excludeTabStop:!0,inputId:V,onChange:S,placeholder:R,prefixIconProps:{iconName:"Search"},ref:e.filterBox,value:x}))):null}),O&&O(),React.createElement(Observer,{filteredItems:h,filteredNoResultsText:b,listBoxItems:{observableValue:D,filter:U},userFilteredItems:{observableValue:k,filter:U}},function(t){var o=null,r="";return(h&&0===h.length||0===D.length)&&!y&&(r=""===x.value?e.props.noItemsText:format(t.filteredNoResultsText||Resources.NoFilterResults,x.value))&&(o=React.createElement("div",{className:"bolt-dropdown-no-items"},r)),React.createElement(React.Fragment,null,o,React.createElement(ListBox,{className:F,containerClassName:css("bolt-dropdown-list-box-container",u),didUpdate:e.listBoxDidUpdate,excludeFocusZone:f,excludeTabStop:!0,searchResultsLoadingText:v,focuszoneProps:null,getUnselectableRanges:g,items:h?h.value:D,loading:B,onActivate:I,onSelect:T,renderItem:L,ref:N,searching:y,selection:W}))}),React.createElement(Observer,{actions:o},function(t){var o=e.props.actions;return o&&o.length?React.createElement("div",{className:"bolt-actions-container flex-column",role:"menubar"},ObservableLike.getValue(o).map(function(e,t){return React.createElement(Button,tslib_1.__assign({key:e.id||t,subtle:!0,excludeTabStop:!0,role:"menuitem",ariaRoleDescription:e.role||"button"},e))})):null}))))},t.defaultProps={width:DefaultWidth},t}(React.Component);export{DropdownCalloutComponent};