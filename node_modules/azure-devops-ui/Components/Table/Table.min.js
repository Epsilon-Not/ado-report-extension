function getVisibleColumnsAndIndices(e){return e.map(function(e,t){return{column:e,originalIndex:t}}).filter(function(e){var t=e.column;return ObservableLike.getValue(t.width)})}function getVariableLength(){return 80*Math.random()+20+"%"}import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{FocusWithin}from"../../FocusWithin";import{FocusZone,FocusZoneContext}from"../../FocusZone";import{Icon}from"../../Icon";import{Intersection}from"../../Intersection";import{getDefaultAnchorProps}from"../../Link";import{List,renderListCell}from"../../List";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Widgets";import{Sizer}from"../../Sizer";import{Tooltip}from"../../TooltipEx";import{css,getSafeId}from"../../Util";import{EventDispatch}from"../../Utilities/Dispatch";import{getTabIndex}from"../../Utilities/Focus";import{ScreenSizeConditional}from"../../Utilities/ScreenSize";import{TableBreakpoint}from"./TableBreakpoint";export var ColumnFill={columnLayout:0,id:"_fill",renderCell:function(e,t){return React.createElement("td",{key:"col-fill","aria-colindex":t+1,"aria-hidden":!0,className:css("bolt-table-cell bolt-list-cell","col-"+t),"data-column-index":t,role:"presentation"})},renderHeaderCell:function(e,t){return React.createElement("th",{key:"col-fill","aria-hidden":!0,className:css(t.headerClassName,"bolt-table-header-cell bolt-table-header-cell-empty","col-header-"+e),"data-column-index":e,role:"presentation"})},width:-100};var Table=function(e){function t(t){var a=e.call(this,t)||this;a.list=React.createRef(),a.onBreakpoint=function(){var e=a.props.tableBreakpoints?getVisibleColumnsAndIndices(a.props.columns).map(function(e){return e.originalIndex}).join(","):"";(a.state.renderInvisible||a.state.visibleColumnsKey!==e)&&a.setState({renderInvisible:!1,visibleColumnsKey:e})},a.onColumnsChanged=function(){return a.forceUpdate(),!1},a.renderHeader=function(){for(var e=a.props,t=e.columns,r=e.showHeader,n=e.renderHeader,l=e.spacerWidth,o=[],i=0,s=0;s<t.length;s++){(c=ObservableLike.getValue(t[s].width))<0&&(i+=c)}for(s=0;s<t.length;s++){var c=ObservableLike.getValue(t[s].width);o[s]=c>=0?c:-c/i*100}var d=null;return!1!==r&&(d=n?n(t):React.createElement(TableHeader,{tableColumns:t})),"function"==typeof r&&(d=React.createElement(ScreenSizeConditional,{condition:function(e){return r(e)}},d)),React.createElement(React.Fragment,null,React.createElement("colgroup",null,React.createElement("col",{"aria-hidden":"true",key:"col-group-left-spacer",style:{width:0===l?l+"%":l+"px"}}),getVisibleColumnsAndIndices(t).map(function(e){var t=e.column,r=e.originalIndex,n=t.widthStyle,l=void 0===n?0:n;return React.createElement(Observer,{key:"col-group-"+r,width:{filter:a.onColumnsChanged,observableValue:t.width}},function(){return React.createElement("col",{style:{width:Math.abs(o[r])+(o[r]<0?"%":0===l?"px":"rem")}})})}),React.createElement("col",{"aria-hidden":"true",key:"col-group-right-spacer",style:{width:0===l?l+"%":l+"px"}})),d)},a.renderLoadingRow=function(e,t){var r=a.props,n=r.columns,l=r.renderLoadingRow,o={ariaBusy:!0,ariaRowOffset:t.ariaRowOffset,data:t.data,eventDispatch:a.state.eventDispatch,excludeTabStop:t.excludeTabStop,itemProvider:a.props.itemProvider,listProps:t.listProps,onFocusItem:t.onFocusItem,renderSpacer:a.props.renderSpacer,selection:a.props.selection,singleClickActivation:a.props.onActivate&&a.props.singleClickActivation};return l?l(e,o):React.createElement(TableLoadingRow,{columns:n,details:o,rowIndex:e})},a.renderRow=function(e,t,r){var n={selectableText:r.selectableText,ariaRowOffset:r.ariaRowOffset,eventDispatch:a.state.eventDispatch,data:r.data,excludeTabStop:r.excludeTabStop,itemProvider:a.props.itemProvider,listProps:r.listProps,onFocusItem:r.onFocusItem,renderSpacer:a.props.renderSpacer,selection:a.props.selection,singleClickActivation:a.props.onActivate&&a.props.singleClickActivation},l=t.renderRow||a.props.renderRow;return l?l(e,t,n):React.createElement(TableRow,{details:n,index:e,linkProps:t.linkProps},renderColumns(e,a.props.columns,t,n))},a.state={columnBehaviors:[],eventDispatch:t.eventDispatch||new EventDispatch,renderInvisible:!!t.tableBreakpoints,visibleColumnsKey:"",tableBehaviors:[],tableWidth:""};for(var r=0;r<t.columns.length;r++){var n=t.columns[r];if(n.behaviors)for(var l=0,o=n.behaviors;l<o.length;l++){(c=o[l])&&c.initialize&&c.initialize({tableProps:t,columnIndex:r},{},a.state.eventDispatch)}}if(t.behaviors)for(var i=0,s=t.behaviors;i<s.length;i++){var c=s[i];c.initialize&&c.initialize(t,a,a.state.eventDispatch)}return a}return tslib_1.__extends(t,e),t.getDerivedStateFromProps=function(e,t){for(var a=[],r=[],n=0;n<e.columns.length;n++){var l=e.columns[n];if(l.behaviors)for(var o=0,i=l.behaviors;o<i.length;o++){var s=i[o];r.push(s)}}return e.behaviors&&a.splice.apply(a,[a.length,0].concat(e.behaviors)),{columnBehaviors:r,tableBehaviors:a}},t.prototype.render=function(){for(var e=this.state,t=e.eventDispatch,a=e.renderInvisible,r=e.visibleColumnsKey,n=this.props,l=n.selectableText,o=n.className,i=n.columns,s=n.containerClassName,c=n.focuszoneProps,d=n.showLines,m=n.id,u=n.itemProvider,p=n.maxHeight,h=n.onActivate,b=n.onFocus,f=n.onSelect,v=n.pageSize,R=n.role,x=n.rowHeight,g=n.scrollable,w=n.selection,C=n.singleClickActivation,y=n.selectRowOnClick,E=n.tableBreakpoints,I=n.virtualize,k=[],S=2*(this.props.spacerWidth||0),N=S,z=S,L=S,T=!1,F=!1,P=!1,D=0,O=0,B=0,W=i;B<W.length;B++){var V=W[B],A=V.maxWidth,H=V.minWidth,_=V.widthStyle,U=void 0===_?0:_,M=ObservableLike.getValue(V.width);k.push(V.width),M<0?(P=!0,z+=H||0,A?(T=!0,N+=A):F=!0,D++):M>0&&(0===U?(L+=M,z+=M,N+=M):(L+=16*M,z+=16*M,N+=16*M),D++),"_fill"===V.id&&O++}var j={selectableText:l,ariaColumnCount:D-O,ariaLabel:this.props.ariaLabel,ariaRowOffset:this.props.showHeader?1:0,className:css(o,"bolt-table",d&&"bolt-table-show-lines"),columnCount:D+2,eventDispatch:t,focuszoneProps:c,id:m,itemProvider:u,maxWidth:T&&!F?N+"px":void 0,maxHeight:p,minWidth:z!==L?z+"px":void 0,onActivate:h,onFocus:b,onSelect:f,pageSize:v,renderHeader:this.renderHeader,renderLoadingRow:this.renderLoadingRow,renderRow:this.renderRow,role:R,rowHeight:x,selection:w,selectRowOnClick:y,singleClickActivation:C,virtualize:I,width:P?"100%":L+"px"},Z=React.createElement("div",{className:css(s,"bolt-table-container flex-grow",a&&"invisible",g&&"v-scroll-auto",E&&"h-scroll-hidden")},E?React.createElement(TableBreakpoint,{columnWidths:k,onBreakpoint:this.onBreakpoint,breakpoints:E}):void 0,React.createElement(List,tslib_1.__assign({},j,{key:r,ref:this.list})));return g&&(Z=React.createElement(Intersection,null,Z)),Z},t.prototype.componentDidMount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentDidMount&&n.componentDidMount(this.props)}for(var a=0,r=this.state.columnBehaviors;a<r.length;a++){var n=r[a];n.componentDidMount&&n.componentDidMount({tableProps:this.props})}},t.prototype.componentDidUpdate=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentDidUpdate&&n.componentDidUpdate(this.props)}for(var a=0,r=this.state.columnBehaviors;a<r.length;a++){var n=r[a];n.componentDidUpdate&&n.componentDidUpdate({tableProps:this.props})}},t.prototype.componentWillUnmount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentWillUnmount&&n.componentWillUnmount()}for(var a=0,r=this.state.columnBehaviors;a<r.length;a++){var n=r[a];n.componentDidUpdate&&n.componentDidUpdate({tableProps:this.props})}},t.prototype.addOverlay=function(e,t,a,r){if(void 0===r&&(r=0),this.list.current)return this.list.current.addOverlay(e,t,a,r)},t.prototype.removeOverlay=function(e){if(this.list.current)return this.list.current.removeOverlay(e)},t.prototype.getFocusIndex=function(){return this.list.current?this.list.current.getFocusIndex():-1},t.prototype.getStats=function(){return this.list.current?this.list.current.getStats():{firstMaterialized:-1,firstRendered:-1,lastMaterialized:-1,lastRendered:-1}},t.prototype.scrollIntoView=function(e,t){if(this.list.current)return this.list.current.scrollIntoView(e,t)},t.defaultProps={role:"grid",selectRowOnClick:!0,showHeader:!0,showLines:!0,singleClickActivation:!0,spacerWidth:8},t}(React.Component);export{Table};export function renderColumns(e,t,a,r){return getVisibleColumnsAndIndices(t).map(function(t,n){var l=t.column;return l.renderCell(e,n,l,a,e+(r.ariaRowOffset?r.ariaRowOffset:1))})};var TableHeader=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props.tableColumns.findIndex(function(e){return ObservableLike.getValue(e.width)&&(e.behaviors&&e.behaviors.length>0||!!e.sortProps)});return React.createElement(FocusZoneContext.Consumer,null,function(a){return React.createElement(FocusZone,{direction:1},React.createElement("thead",null,React.createElement(FocusWithin,null,function(r){return React.createElement("tr",{"aria-rowindex":1,className:css("bolt-table-header-row",r.hasFocus&&"focused"),"data-row-index":-1,onBlur:r.onBlur,onFocus:r.onFocus},React.createElement("th",{"aria-hidden":"true",key:"left-spacer",role:"presentation"}),getVisibleColumnsAndIndices(e.props.tableColumns).map(function(e,r){var n=e.column,l=e.originalIndex;return n.renderHeaderCell?n.renderHeaderCell(r,n,a.focuszoneId,l===t):n.iconProps||n.name?React.createElement(TableHeaderCell,{key:"col-header-"+r,column:n,columnIndex:r,focuszoneId:a.focuszoneId,isFirstActionableHeader:l===t},React.createElement(Tooltip,{overflowOnly:!0,text:n.name},React.createElement("div",{className:"bolt-table-header-cell-text text-ellipsis body-s"},n.iconProps&&Icon(n.iconProps),React.createElement("span",null,n.name)))):React.createElement("th",{"aria-colindex":r+1,"aria-label":n.ariaLabel||Resources.EmptyColumnHeaderLabel,"aria-readonly":"true",key:"col-header-"+r})}),React.createElement("th",{"aria-hidden":"true",key:"right-spacer",role:"presentation"}))}),React.createElement("tr",{className:"bolt-table-header-row","data-row-index":-1,role:"presentation"},React.createElement("td",{key:"left-spacer",className:"bolt-table-header-spacer",role:"presentation"}),getVisibleColumnsAndIndices(e.props.tableColumns).map(function(e){var t=e.originalIndex;return React.createElement("td",{key:"col-header-"+t,className:css("bolt-table-header-spacer","col-header-"+t),role:"presentation"})}),React.createElement("td",{key:"right-spacer",className:"bolt-table-header-spacer",role:"presentation"}))))})},t}(React.Component),TableHeaderCell=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.element=React.createRef(),t.state={measuredWidth:0},t.onSize=function(e,a){var r=t.props.column;r.onSize&&r.onSize(e,t.props.columnIndex,a,r)},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e,t=this,a=this.props,r=a.column,n=a.columnIndex,l=a.focuszoneId,o=a.isFirstActionableHeader;return r.onSize&&(e=React.createElement(Observer,{width:r.width},function(e){var a=e.width;return a<0&&(a=t.state.measuredWidth),React.createElement(Sizer,{className:"bolt-table-header-sizer",divider:!1,maxSize:r.maxWidth,minSize:r.minWidth,onSize:t.onSize,onSizeEnd:t.props.column.onSizeEnd,orientation:0,position:0,size:a})})),React.createElement(FocusZoneContext.Consumer,null,function(a){var i,s=r.behaviors&&r.behaviors.length>0||!!r.sortProps,c=r.sortProps,d=void 0===c?{}:c,m=r.sortProps&&void 0!==d.sortOrder?Icon({className:"bolt-table-header-sort-icon body-s",iconName:0===d.sortOrder?"SortUp":"SortDown"}):null;return 0===r.justification?i="justify-start":1===r.justification&&(i="justify-end"),React.createElement("th",{"aria-colindex":n+1,"aria-readonly":"true","aria-sort":void 0!==d.sortOrder?0===d.sortOrder?"ascending":"descending":void 0,className:css(r.headerClassName,"bolt-table-header-cell","col-header-"+n,s&&"bolt-table-header-cell-actionable"),"data-column-index":n,"data-focuszone":s&&css(o&&l,a.focuszoneId),ref:t.element,tabIndex:s&&o?0:-1},React.createElement("div",{className:css("bolt-table-header-cell-content flex-row",i)},e,1===r.justification&&m,t.props.children,1!==r.justification&&m))})},t.prototype.componentDidMount=function(){this.updateMeasuredWidth()},t.prototype.componentDidUpdate=function(){this.updateMeasuredWidth()},t.prototype.updateMeasuredWidth=function(){var e=this.props.column;if(e.onSize&&this.element.current&&ObservableLike.getValue(e.width)<0){var t=this.element.current.getBoundingClientRect().width;t!==this.state.measuredWidth&&this.setState({measuredWidth:t})}},t}(React.Component);export{TableHeaderCell};export function TableRow(e){var t,a,r=function(e){return e.defaultPrevented||37===e.which&&n.current&&(n.current.focus(),e.preventDefault()),1},n=React.useState(function(){return React.createRef()})[0],l=e.details,o=e.index,i=e.linkProps,s=l.selectableText,c=l.ariaLabel,d=l.ariaBusy,m=l.ariaDescribedBy,u=l.ariaPosInSet,p=l.ariaRowOffset,h=l.ariaSetSize,b=l.excludeFocusZone,f=l.id,v=l.renderSpacer,R=l.role,x=l.selection,g=l.singleClickActivation,w=i?"a":"tr",C=getDefaultAnchorProps(i);return"menuitemcheckbox"===R?t=x&&x.selected(o):a=x&&x.selected(o),React.createElement(FocusWithin,{onFocus:function(t){e.details.onFocusItem(e.index,t)}},function(y){return React.createElement(FocusZoneContext.Consumer,null,function(E){return React.createElement(FocusZone,{direction:1,postprocessKeyStroke:r},React.createElement(w,tslib_1.__assign({},C,{"aria-busy":d,"aria-checked":t,"aria-describedby":m,"aria-label":c,"aria-rowindex":"menuitemcheckbox"===R?void 0:o+p,"aria-posinset":null===u?void 0:u,"aria-selected":a,"aria-setsize":null===h?void 0:h,className:css(e.className,"bolt-table-row bolt-list-row",0===o&&"first-row",y.hasFocus&&"focused",x&&x.selected(o)&&"selected",g&&"single-click-activation",i&&"v-align-middle",s&&"selectable-text"),"data-focuszone":b||x&&!x.selectable(o)?void 0:E.focuszoneId,"data-row-index":e.index,id:getSafeId(f),role:R||"row",tabIndex:getTabIndex(l),onBlur:y.onBlur,onFocus:y.onFocus,ref:n}),React.createElement("td",{"aria-hidden":"true",key:"left-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},v&&v(o,!0)),e.children,React.createElement("td",{"aria-hidden":"true",key:"right-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},v&&v(o,!1))))})})};export function TableLoadingRow(e){return React.createElement(TableRow,{className:"bolt-list-row-loading",details:e.details,index:e.rowIndex},getVisibleColumnsAndIndices(e.columns).map(function(e,t){return SimpleTableCell({columnIndex:t,children:renderLoadingCell(e.column.columnLayout)})}))};export function TableCell(e){var t,a=e.ariaLabel,r=e.ariaRowIndex,n=e.className,l=e.colspan,o=e.columnIndex,i=e.tableColumn;return i&&(0===i.justification?t="justify-cell-start":1===i.justification&&(t="justify-cell-end")),React.createElement("td",{"aria-colindex":o+1,"aria-label":a,"aria-readonly":i&&i.readonly,"aria-rowindex":r,className:css(n,i&&i.className,"bolt-table-cell bolt-list-cell",t),colSpan:l,"data-column-index":o,key:"col-"+o,role:"gridcell"},e.children)};export function SimpleTableCell(e){var t=React.createElement("div",{className:css(e.contentClassName,"bolt-table-cell-content flex-row flex-center")},e.children);return TableCell({ariaLabel:e.ariaLabel,ariaRowIndex:e.ariaRowIndex,children:t,className:e.className,colspan:e.colspan,columnIndex:e.columnIndex,tableColumn:e.tableColumn})};export function TwoLineTableCell(e){var t,a="bolt-table-two-line-cell-item flex-row scroll-hidden",r=React.createElement("div",{className:a},e.line1),n=React.createElement("div",{className:a},e.line2),l=React.createElement(React.Fragment,null,r,n);return t=e.iconProps?React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-row flex-center")},Icon(tslib_1.__assign({},e.iconProps,{className:css(e.iconProps.className,"bolt-table-two-line-cell-icon flex-noshrink")})),React.createElement("div",{className:"flex-column scroll-hidden"},l)):React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-column")},l),TableCell({ariaRowIndex:e.ariaRowIndex,children:t,colspan:e.colspan,columnIndex:e.columnIndex,className:"bolt-table-two-line-cell",tableColumn:e.tableColumn})};export function renderEmptyCell(e,t){return React.createElement(TableCell,{columnIndex:t,key:t})};export function renderSimpleCell(e,t,a,r,n){return renderSimpleCellValue(t,a,r[a.id],n)};export function renderSimpleCellValue(e,t,a,r){var n=t.columnStyle,l=!(!a||"string"==typeof a||"number"==typeof a||!a.href);return React.createElement(SimpleTableCell,{ariaRowIndex:r,className:css(2===n&&"bolt-table-cell-primary",1===n&&"bolt-table-cell-secondary",3===n&&"bolt-table-cell-tertiary"),columnIndex:e,contentClassName:l?"bolt-table-cell-content-with-link":void 0,key:e,tableColumn:t},a&&renderListCell(a))};export function renderLoadingCell(e){return 1===e||void 0===e?React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," "):2===e?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-small flex-noshrink"}),React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," ")):3===e?React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," ")):4===e?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-large flex-noshrink"}),React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "))):null};