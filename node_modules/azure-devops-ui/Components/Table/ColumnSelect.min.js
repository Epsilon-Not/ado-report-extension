import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ObservableValue}from"../../Core/Observable";import{announce}from"../../Core/Util/Accessibility";import{Checkbox,TriStateCheckbox}from"../../Checkbox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Widgets";import{css,preventDefault}from"../../Util";var ColumnSelect=function(){function e(){var e=this;this.columnSelectBehavior={initialize:function(t){e.ariaHidden="menu"===t.tableProps.role,e.itemProvider=t.tableProps.itemProvider,e.selection=t.tableProps.selection,e.onSelect=t.tableProps.onSelect},componentDidMount:function(t){e.componentDidMount(t)},componentDidUpdate:function(t){e.componentDidUpdate(t)},componentWillUnmount:function(){e.componentWillUnmount()}},this.allSelected=new ObservableValue(!1),this.columnLayout=0,this.id="_select",this.width=2.5,this.widthStyle=1,this.behaviors=[this.columnSelectBehavior],this.renderCell=function(t,i,o){var n=e.selection,l=n&&n.selected(t),c=n&&n.selectable(t);return React.createElement("td",{"aria-colindex":i+1,"aria-hidden":e.ariaHidden,className:css("bolt-table-cell-select bolt-table-cell bolt-list-cell","col-"+i),"data-column-index":i,key:"col-select",onClick:preventDefault,onDoubleClick:preventDefault,onMouseDown:function(i){e.updateSelection(i,t),i.preventDefault()},onKeyDown:function(i){32===i.which&&(e.updateSelection(i,t),i.preventDefault())}},React.createElement("div",{className:"flex-row justify-center"},React.createElement("span",{className:"flex-row-inline"},React.createElement(Checkbox,{ariaLabel:Resources.SelectRowLabel,checked:!!l,excludeTabStop:!0,disabled:!c}))))},this.renderHeaderCell=function(t,i,o){return React.createElement("th",{"aria-colindex":t+1,className:css("bolt-table-cell-select bolt-table-header-cell","col-header-"+t),"data-column-index":t,key:"col-select"},React.createElement("div",{className:"flex-row"},React.createElement(Observer,{allSelected:e.allSelected},function(t){var i=e,n=i.itemProvider,l=i.selection,c=n&&n.length;return React.createElement("div",{className:"flex-row flex-grow justify-center"},l&&l.multiSelect&&-1!==c&&React.createElement(TriStateCheckbox,{ariaLabel:Resources.SelectAllRowsLabel,checked:t.allSelected,focuszoneId:o,onChange:e.onChangeHeader}))})))},this.onChangeHeader=function(t){var i=e,o=i.itemProvider,n=i.onSelect,l=i.selection;if(l&&(!1!==e.allSelected.value?(l.clear(),announce(Resources.AllRowsUnselectedMessage,!0)):(l.select(0,o&&o.length),announce(Resources.AllRowsSelectedMessage,!0))),n&&o)for(var c=0;c<o.length;c++)n(t,e.getListRow(c))},this.onSelectionChange=function(){var t=e,i=t.itemProvider,o=t.selection;if(o){var n=o.selectedCount,l=i&&i.length-o.unselectableCount;e.allSelected.value=n>0&&(n===l||void 0)}},this.updateSelection=function(t,i){var o=e,n=o.onSelect,l=o.selection;if(l&&(l.selected(i)?l.unselect(i):l.select(i,1,!0)),n){n(t,e.getListRow(i))}},this.getListRow=function(t){return{data:e.itemProvider?e.itemProvider.value[t]:{},index:t}}}return e.prototype.componentDidMount=function(e){var t=this.itemProvider,i=this.selection;i&&(i.subscribe(this.onSelectionChange),this.onSelectionChange()),t&&t.subscribe&&t.subscribe(this.onSelectionChange)},e.prototype.componentDidUpdate=function(e){var t=this.selection;t!==e.tableProps.selection&&(t&&t.unsubscribe(this.onSelectionChange),t=e.tableProps.selection,this.selection=t,t&&t.subscribe(this.onSelectionChange)),t&&this.onSelectionChange(),this.itemProvider!==e.tableProps.itemProvider&&(this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange),this.itemProvider=e.tableProps.itemProvider,this.itemProvider&&this.itemProvider.subscribe&&this.itemProvider.subscribe(this.onSelectionChange))},e.prototype.componentWillUnmount=function(){var e=this.selection;e&&e.unsubscribe(this.onSelectionChange),this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange)},e}();export{ColumnSelect};