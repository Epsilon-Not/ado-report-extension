import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Splitter.css";import*as React from"react";import{EventManagement}from"../../Core/EventManagement";import{ObservableLike,ObservableValue}from"../../Core/Observable";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Splitter";import{css,getSafeId}from"../../Util";var DIVIDER_MOVE_INCREMENT=20,DIVIDER_WIDTH=4,COLLAPSED_PANE_SIZE=38,idCount=0,Splitter=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._cachedNearElement=null,n._cachedFarElement=null,n.events=new EventManagement,n.uncontrolledFixedSize=new ObservableValue(void 0),n.placeholderPosition=new ObservableValue(void 0),n.collapse=function(){n.isCollapsed()||n.props.onCollapsedChanged&&n.props.onCollapsedChanged(!0)},n.expand=function(){n.isCollapsed()&&n.props.onCollapsedChanged&&n.props.onCollapsedChanged(!1)},n._onDividerKeyDown=function(e){var t=n.props,i=t.disabled,r=t.splitterDirection;if(!i&&!n._isDragging()){switch(e.keyCode){case 37:0===r&&n._moveDivider(-DIVIDER_MOVE_INCREMENT);break;case 39:0===r&&n._moveDivider(DIVIDER_MOVE_INCREMENT);break;case 38:1===r&&n._moveDivider(-DIVIDER_MOVE_INCREMENT);break;case 40:1===r&&n._moveDivider(DIVIDER_MOVE_INCREMENT);break;default:return}e.preventDefault(),e.stopPropagation()}},n._onDividerMouseDown=function(e){n._fixedRef&&!n.props.disabled&&(e.preventDefault(),e.stopPropagation(),n._dragAnchorPos=n._getEventBoundedClientPos(e),n._previousFixedSize=n._getElementSize(n._fixedRef),void 0!==n.placeholderPosition.value&&(n.placeholderPosition.value=void 0),n._attachWindowEvents(),n._handleDragMouseEvent(e))},n._onDividerMouseMove=function(e){n._handleDragMouseEvent(e)},n._onDividerMouseUp=function(e){n._detachWindowEvents();var t=n._getEventBoundedClientPos(e),i=n._getNewFixedSize(n._previousFixedSize,t-n._dragAnchorPos);n.placeholderPosition.value=void 0,n._setFixedSize(i),n._fireWindowResize()},n.uncontrolledFixedSize.value=t.initialFixedSize,n.fixedPaneId="splitter-fixed-pane"+idCount++,n}return tslib_1.__extends(t,e),t.prototype.componentDidMount=function(){this._fireWindowResize()},t.prototype.componentWillUnmount=function(){this.events.removeAllListeners()},t.prototype.render=function(){var e=this,t=this.props,i=t.className,n=t.collapsed,r=t.fixedElement,o=t.maxFixedSize,s=t.minFixedSize,a=t.onRenderFarElement,l=t.onRenderNearElement,d=t.splitterDirection,p=0===r?!!l:!!a;return React.createElement(Observer,{collapsed:n,fixedSize:void 0===this.props.fixedSize?this.uncontrolledFixedSize:this.props.fixedSize,placeholderPosition:this.placeholderPosition},function(t){var n;if(t.collapsed)n=COLLAPSED_PANE_SIZE;else if(t.fixedSize){n=Math.max(t.fixedSize,s||0);var r=o;!r&&e._splitterContainer&&(r=e._getElementSize(e._splitterContainer)),r&&n>r&&(n=r)}else void 0!==s?n=s:void 0!==o&&(n=o);return React.createElement("div",{className:css(i,"vss-Splitter--container",0===d&&"vss-Splitter--container-row",1===d&&"vss-Splitter--container-column",e._isDragging()&&"vss-Splitter--container-dragging"),ref:function(t){return e._splitterContainer=t}},e._renderNearElement(n),p?e._renderDivider(n):null,e._renderDragPlaceHolder(),e._renderFarElement(n))})},t.prototype._renderNearElement=function(e){var t=this.props,i=t.fixedElement,n=t.onRenderNearElement,r=t.nearElementClassName;if(!this._isDragging()||!this._cachedNearElement)if(n){var o=n();this._cachedNearElement=0===i?this._renderFixedPane(o,r,e):this._renderFlexiblePane(o,r)}else this._cachedNearElement=null;return this._cachedNearElement},t.prototype._renderFarElement=function(e){var t=this.props,i=t.fixedElement,n=t.onRenderFarElement,r=t.farElementClassName;if(!this._isDragging()||!this._cachedFarElement)if(n){var o=n();this._cachedFarElement=1===i?this._renderFixedPane(o,r,e):this._renderFlexiblePane(o,r)}else this._cachedFarElement=null;return this._cachedFarElement},t.prototype._renderFixedPane=function(e,t,i){var n,r=this,o=this.props,s=o.expandTooltip,a=o.splitterDirection,l=this.isCollapsed(),d=(n={},n[0===a?"width":"height"]=void 0===i?"50%":i,n);return e?React.createElement("div",{className:css("vss-Splitter--pane-fixed",l?"flex-column collapsed":t),id:getSafeId(this.fixedPaneId),style:d,ref:function(e){return r._fixedRef=e}},l?React.createElement(Button,{className:"vss-splitter-expand-button",iconProps:{iconName:this.getCollapsedButtonIconName()},onClick:this.expand,subtle:!0,tooltipProps:{text:s||Resources.ExpandTooltip}}):e):null},t.prototype.getCollapsedButtonIconName=function(){var e=1===this.props.fixedElement;return 0===this.props.splitterDirection?e?"DoubleChevronLeft":"DoubleChevronRight":e?"DoubleChevronUp":"DoubleChevronDown"},t.prototype._renderFlexiblePane=function(e,t){return React.createElement("div",{className:css("vss-Splitter--pane-flexible",t)},e)},t.prototype._renderDivider=function(e){var t=this._getSplitterBoundaries(),i=t.startBound,n=t.endBound;return React.createElement("div",{"aria-valuemin":i,"aria-valuemax":n,"aria-label":this.props.ariaLabel,"aria-labelledby":this.props.ariaLabel?void 0:this.props.ariaLabelledBy?this.props.ariaLabelledBy:getSafeId(this.fixedPaneId),"aria-orientation":1===this.props.splitterDirection?"horizontal":"vertical","aria-valuenow":e,"aria-valuetext":e?format(Resources.SplitterValueText,e):void 0,role:"separator",tabIndex:0,className:css("vss-Splitter--divider",this._isDragging()&&"vss-Splitter--divider-dragging"),onKeyDown:this._onDividerKeyDown,onMouseDown:this._onDividerMouseDown})},t.prototype._renderDragPlaceHolder=function(){var e;if(this._isDragging()){var t=(e={},e[0===this.props.splitterDirection?"left":"top"]=this.placeholderPosition.value,e);return React.createElement("div",{className:"vss-Splitter--drag-placeholder",style:t})}return null},t.prototype._handleDragMouseEvent=function(e){var t=this.props.fixedElement;e.preventDefault(),e.stopPropagation();var i=this._getEventBoundedClientPos(e),n=this._getNewFixedSize(this._previousFixedSize,i-this._dragAnchorPos),r=n.collapsed?0:n.fixedSize,o=0===t?r:this._getElementSize(this._splitterContainer)-r-DIVIDER_WIDTH;o!==this.placeholderPosition.value&&(this.placeholderPosition.value=o)},t.prototype._setFixedSize=function(e){var t=this.props.onFixedSizeChanged;if(e.collapsed)this.collapse();else{var i=e.fixedSize;this.uncontrolledFixedSize.value=i,t&&t(i),this.isCollapsed()&&this.expand()}},t.prototype._moveDivider=function(e){var t=this._getElementSize(this._fixedRef),i=this._getNewFixedSize(t,e);this._setFixedSize(i),this._fireWindowResize()},t.prototype._attachWindowEvents=function(){this.events.addEventListener(window,"mousemove",this._onDividerMouseMove),this.events.addEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._detachWindowEvents=function(){this.events.removeEventListener(window,"mousemove",this._onDividerMouseMove),this.events.removeEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._getEventBoundedClientPos=function(e){var t;switch(this.props.splitterDirection){case 0:t=e.clientX;break;case 1:t=e.clientY;break;default:t=0}return this._getBoundedClientPos(t)},t.prototype._getBoundedClientPos=function(e){var t=this._getSplitterBoundaries(!!this.props.onCollapsedChanged),i=t.startBound,n=t.endBound;return Math.max(i,Math.min(e,n))-this._getElementStartPos(this._splitterContainer)},t.prototype._getSplitterBoundaries=function(e){void 0===e&&(e=!1);var t=this.props,i=t.fixedElement,n=t.minFixedSize,r=t.maxFixedSize;if(!this._splitterContainer)return{startBound:0,endBound:0};e&&(n=0);var o=this._getElementStartPos(this._splitterContainer),s=o+this._getElementSize(this._splitterContainer);return{startBound:0===i?n?o+n:o:r?s-r:o,endBound:0===i?r?o+r:s:n?s-n:s}},t.prototype._getNewFixedSize=function(e,t){var i=this.props,n=i.fixedElement,r=i.maxFixedSize,o=i.minFixedSize,s=void 0===o?0:o,a=i.onCollapsedChanged;void 0===r&&(r=this._getElementSize(this._splitterContainer));var l=t;1===n&&(l*=-1);var d=e+l;d>r&&(d=r);var p=this.isCollapsed();return a&&(p=d<COLLAPSED_PANE_SIZE||!this.isCollapsed()&&d<s),d<s&&(d=s),{fixedSize:d,collapsed:p}},t.prototype.isCollapsed=function(){return!!ObservableLike.getValue(this.props.collapsed)},t.prototype._isDragging=function(){return void 0!==this.placeholderPosition.value},t.prototype._getElementSize=function(e){return 0===this.props.splitterDirection?e.clientWidth:e.clientHeight},t.prototype._getElementStartPos=function(e){var t=e.getBoundingClientRect();return 0===this.props.splitterDirection?t.left:t.top},t.prototype._fireWindowResize=function(){var e=document.createEvent("Event");e.initEvent("resize",!1,!0),window.dispatchEvent(e)},t.defaultProps={fixedElement:1,splitterDirection:0},t}(React.Component);export{Splitter};