import*as tslib_1 from"tslib";import{Observable,ObservableLike}from"../Core/Observable";var AggregateItemProvider=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.internalCollections=[],t.items=[],t}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collections",{get:function(){return this.internalCollections},enumerable:!0,configurable:!0}),t.prototype.push=function(e){var t,i;if(ObservableLike.isObservable(e)){var r=e,s=this.getSubscriber(this.internalCollections.length);i={items:r.value,provider:r,subscriber:s},this.subscriberCount&&ObservableLike.subscribe(i.provider,s)}else e.value?i={items:e.value,provider:e}:e.length&&(i={items:e});i&&(this.internalCollections.push(i),i.items.length&&((t=this.items).push.apply(t,i.items),this.subscriberCount&&this.notify({addedItems:i.items,index:this.items.length-i.items.length},"push")))},t.prototype.getItem=function(e){for(var t=0;t<this.internalCollections.length&&0+(this.internalCollections[t].provider?this.internalCollections[t].provider.length:this.internalCollections[t].items.length)<e;)t++;if(t<this.internalCollections.length)return this.internalCollections[t].provider&&this.internalCollections[t].provider.getItem?this.internalCollections[t].provider.getItem(e):this.internalCollections[t].items[e]},t.prototype.subscribe=function(t,i){var r;if(e.prototype.subscribe.call(this,t,i),1===this.subscriberCount){for(var s=0,n=this.internalCollections;s<n.length;s++){(a=n[s]).subscriber&&a.provider&&a.provider.subscribe&&a.provider.subscribe(a.subscriber)}for(var o=[],l=0,c=this.internalCollections;l<c.length;l++){var a=c[l];o.push.apply(o,a.items)}(r=this.items).splice.apply(r,[0,this.items.length].concat(o))}},t.prototype.unsubscribe=function(t,i){if(e.prototype.unsubscribe.call(this,t,i),0===this.subscriberCount)for(var r=0,s=this.internalCollections;r<s.length;r++){var n=s[r];n.subscriber&&n.provider&&n.provider.unsubscribe&&n.provider.unsubscribe(n.subscriber)}},t.prototype.getSubscriber=function(e){var t=this;return function(i){for(var r,s,n=i.index,o=0;o<e;o++)n+=t.internalCollections[o].items.length;if(i.changedItems)(r=t.items).splice.apply(r,[n,i.changedItems.length].concat(i.changedItems)),t.notify({changedItems:i.changedItems,index:n},"change");else{var l=i.removedItems||[],c=i.addedItems||[];(s=t.items).splice.apply(s,[n,l.length].concat(c)),t.notify({removedItems:l,addedItems:c,index:n},"splice")}}},t}(Observable);export{AggregateItemProvider};