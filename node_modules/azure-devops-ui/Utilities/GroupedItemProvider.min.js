import{ObservableArray}from"../Core/Observable";var GroupedItemProvider=function(){function t(t,e,r){this.listItems=new ObservableArray,this.internalGroups=e.slice(),this.groupedItems=[[]];for(s=0;s<this.internalGroups.length;s++)this.groupedItems.push([]);this.addItems(t);for(var s=0;s<this.internalGroups.length;s++)this.internalGroups[s].loading&&this.setGroupLoading(this.internalGroups[s].id,!0,this.internalGroups[s].loadingItem);r&&this.addHeaders(1,this.groups.length),this.manageHeaders=!!r}return Object.defineProperty(t.prototype,"groups",{get:function(){return this.internalGroups},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.listItems.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.listItems.value},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t,e){this.listItems.subscribe(t,e)},t.prototype.unsubscribe=function(t,e){return this.listItems.unsubscribe(t,e)},t.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.addItems(t),t.length},t.prototype.pushGroups=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.addGroups.apply(this,[this.internalGroups.length].concat(t)),this.internalGroups.length},t.prototype.pop=function(){var t=this.listItems.pop();return t&&this.removeItems([t]),t},t.prototype.removeAll=function(t){var e=this.listItems.removeAll(t);return this.removeItems(e,!1),e},t.prototype.splice=function(t,e){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var i=this.listItems.splice(t,e);return this.removeItems(i,!1),this.addItems(r,!0,t),i},t.prototype.change=function(t){for(var e,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var i=this.listItems.value.slice(t,r.length);return this.removeItems(i,!1),this.addItems(r,!1),(e=this.listItems).change.apply(e,[t].concat(r)),r.length},t.prototype.spliceGroups=function(t,e){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];for(var i=0;i<e;i++){var o=t+i+1;if(this.groupedItems.length>o){if(this.removeItems(this.groupedItems[o].slice()),this.manageHeaders){var n=this.groupedItems.findIndex(function(t){return t.length>0});n>0&&3===this.groupedItems[n][0].type&&this.removeItems([this.groupedItems[n][0]])}this.groupedItems.splice(o,1)}}var p=this.internalGroups.splice(t,e);return this.addGroups.apply(this,[t].concat(r)),p},t.prototype.setGroupLoading=function(t,e,r){var s=this.groups.findIndex(function(e){return e.id===t});if(s<0)$DEBUG&&console.warn("Tried to set loading on group "+t+" that is not in the group set.");else{s++;var i=this.groupedItems[s],o=i.findIndex(function(t){return 4===t.type});if(!e&&i.length&&o>-1)this.removeItems([i[o]]);else if(e&&-1===o){var n=r||{id:t+"-loading",type:4,groupId:t};this.addItems([n])}this.groups[s-1].loading=e}},t.prototype.addHeaders=function(t,e){void 0===e&&(e=1);for(var r=function(t){var e=s.groups[t-1];if(s.groupedItems[t].length>0){s.groupedItems[t].find(function(t){return 2===t.type})||s.addItems([{id:e.id+"-header",text:e.name||e.id,type:2,groupId:e.id}]),s.groupedItems.some(function(e,r){return r<t&&e.length>0})&&!s.groupedItems[t].find(function(t){return 3===t.type})&&s.addItems([{id:e.id+"-divider",type:3,groupId:e.id}]);var r=s.groupedItems.findIndex(function(e,r){return r>t&&e.length>0});r>0&&!s.groupedItems[r].find(function(t){return 3===t.type})&&(e=s.groups[r-1],s.addItems([{id:e.id+"-divider",type:3,groupId:e.id}]))}},s=this,i=t;i<t+e;i++)r(i)},t.prototype.addGroups=function(t){for(var e,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];(e=this.internalGroups).splice.apply(e,[t,0].concat(r));for(var i=[],o=0;o<r.length;o++){this.groupedItems.splice(t+o+1,0,[]);for(var n=this.groupedItems[0].length-1;n>=0;n--)if(this.groupedItems[0][n].groupId===r[o].id){var p=this.groupedItems[0].splice(n,1)[0];this.listItems.splice(n,1),i.unshift(p)}}this.addItems(i),this.manageHeaders&&this.addHeaders(t+1,r.length);for(o=0;o<r.length;o++)r[o].loading&&this.setGroupLoading(r[o].id,!0,r[o].loadingItem)},t.prototype.addItems=function(t,e,r){if(void 0===e&&(e=!0),void 0!==r)for(s=t.length-1;s>=0;s--)this.addItem(t[s],r);else for(var s=0;s<t.length;s++)this.addItem(t[s],r);e&&this.addToListItems()},t.prototype.addToListItems=function(){for(var t,e=[],r=0;r<this.groupedItems.length;r++)e.push.apply(e,this.groupedItems[r]);for(var s,i=0,o={},n=0;n<e.length;n++)this.listItems.value[i]===e[n]?(i++,s=void 0):void 0!==s?o[s].push(e[n]):(s=i,o[i]=[e[n]]);for(var p=Object.keys(o),r=p.length-1;r>=0;r--)(t=this.listItems).splice.apply(t,[parseInt(p[r]),0].concat(o[parseInt(p[r])]))},t.prototype.addItem=function(t,e){var r=0,s=0,i=t.groupId;void 0!==i&&(r=this.internalGroups.findIndex(function(t){return t.id===i})+1);for(var o=0;o<r;o++)s+=this.groupedItems[o].length;if(3===t.type)this.groupedItems[r].unshift(t);else if(2===t.type)this.groupedItems[r].length&&3===this.groupedItems[r][0].type?(this.groupedItems[r].splice(1,0,t),s++):this.groupedItems[r].unshift(t);else{var n=this.groupedItems[r].length;void 0!==e&&e>=s&&e<=s+this.groupedItems[r].length?(n=e-s,s=e):void 0!==e&&e<s?n=0:s+=this.groupedItems[r].length,this.groupedItems[r].splice(n,0,t),r>0&&1===this.groupedItems[r].length&&this.manageHeaders&&this.addHeaders(r)}},t.prototype.removeItems=function(t,e){void 0===e&&(e=!0);for(var r=function(r){var i=0,o=0,n=t[r].groupId;void 0!==n&&(i=s.internalGroups.findIndex(function(t){return t.id===n})+1);for(var p=0;p<i;p++)o+=s.groupedItems[p].length;var d=s.groupedItems[i],u=d.indexOf(t[r]);d.splice(u,1),e&&s.listItems.splice(o+u,1)},s=this,i=0;i<t.length;i++)r(i)},t}();export{GroupedItemProvider};