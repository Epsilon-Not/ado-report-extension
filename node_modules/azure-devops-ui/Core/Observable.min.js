import*as tslib_1 from"tslib";import*as React from"react";var Observable=function(){function e(){this.observers={},this.subscriberCount=0}return e.prototype.notify=function(e,t,r){var s=function(e,t,r){try{e(t,r)}catch(e){console.warn(e),e&&"function"==typeof ErrorEvent&&window.dispatchEvent(new ErrorEvent("error",{error:e,filename:"Observable.ts",message:e.message}))}};if(this.observers[t])for(var n=this.observers[t].slice(),i=0;i<n.length;i++)s(n[i],e,t);if(this.observers[""])for(var n=this.observers[""].slice(),i=0;i<n.length;i++)s(n[i],e,t);r&&(this.events||(this.events=[]),this.events.push({action:t,value:e}))},e.prototype.subscribe=function(e,t){if(t=t||"",this.observers[t]||(this.observers[t]=[]),this.observers[t].push(e),this.subscriberCount++,this.events)for(var r=0,s=this.events;r<s.length;r++){var n=s[r];t&&n.action!==t||e(n.value,n.action)}},e.prototype.unsubscribe=function(e,t){if(t=t||"",this.observers[t]){var r=this.observers[t].indexOf(e);r>=0&&(this.observers[t].splice(r,1),this.subscriberCount--)}},e}();export{Observable};export var ObservableLike;!function(e){function t(e){return e&&"function"==typeof e.subscribe}e.isObservable=t,e.getValue=function(e){return t(e)?e.value:e},e.subscribe=function(e,r,s){t(e)&&e.subscribe(r,s)},e.unsubscribe=function(e,r,s){t(e)&&e.unsubscribe(r,s)}}(ObservableLike||(ObservableLike={}));var ObservableValue=function(e){function t(t){var r=e.call(this)||this;return r.v=t,r}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.v},set:function(e){this.v=e,this.notify(this.v,"set")},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableValue};var ObservableObject=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.objects={},t}return tslib_1.__extends(t,e),t.prototype.add=function(e,t){this.objects.hasOwnProperty(e)||(this.objects[e]=t,this.notify({key:e,value:t},"add"))},t.prototype.get=function(e){return this.objects[e]},t.prototype.set=function(e,t){this.objects.hasOwnProperty(e)?(this.objects[e]=t,this.notify({key:e,value:t},"replace")):this.add(e,t)},t.prototype.keys=function(){return Object.keys(this.objects)},t}(Observable);export{ObservableObject};var ObservableArray=function(e){function t(t){void 0===t&&(t=[]);var r=e.call(this)||this;return r.internalItems=t||[],r}return tslib_1.__extends(t,e),t.prototype.change=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return(t=this.internalItems).splice.apply(t,[e,r.length].concat(r)),this.notify({index:e,changedItems:r},"change"),r.length},Object.defineProperty(t.prototype,"length",{get:function(){return this.internalItems.length},enumerable:!0,configurable:!0}),t.prototype.push=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(t.length){var s=this.internalItems.length;(e=this.internalItems).push.apply(e,t),this.notify({addedItems:t,index:s},"push")}return t.length},t.prototype.pop=function(){var e=this.internalItems.pop();return void 0!==e&&this.notify({index:this.internalItems.length,removedItems:[e]},"pop"),e},t.prototype.removeAll=function(e){for(var t=[],r=[],s=0,n=this.internalItems;s<n.length;s++){a=n[s];!e||e(a)?t.push(a):r.push(a)}if(t.length>0){this.internalItems.splice(0,this.internalItems.length);for(var i=0,o=r;i<o.length;i++){var a=o[i];this.internalItems.push(a)}this.notify({index:0,removedItems:t},"removeAll")}return t},t.prototype.splice=function(e,t){for(var r,s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];var i=(r=this.internalItems).splice.apply(r,[e,t].concat(s));return this.notify({addedItems:s,index:e,removedItems:i},"splice"),i},Object.defineProperty(t.prototype,"value",{get:function(){return this.internalItems},set:function(e){var t;if(e===this.internalItems)t=this.internalItems;else if(t=this.internalItems.slice(),this.internalItems.length=0,e.length)for(var r=0,s=e;r<s.length;r++){var n=s[r];this.internalItems.push(n)}this.notify({addedItems:e,index:0,removedItems:t},"splice")},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableArray};var ObservableCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collections=[],t.items=[],t}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.items},enumerable:!0,configurable:!0}),t.prototype.push=function(e,t){var r;if(ObservableLike.isObservable(e)){var s=e,n=this.getSubscriber(this.collections.length,t);r={items:s.value,observable:s,subscriber:n},this.subscriberCount&&ObservableLike.subscribe(r.observable,n)}else e.length&&(r={items:e});if(r&&(this.collections.push(r),r.items.length)){for(var i=this.transformItems(r.items,t),o=0,a=i;o<a.length;o++){var l=a[o];this.items.push(l)}this.subscriberCount&&this.notify({addedItems:i,index:this.items.length-i.length},"push")}},t.prototype.subscribe=function(t,r){if(e.prototype.subscribe.call(this,t,r),1===this.subscriberCount)for(var s=0,n=this.collections;s<n.length;s++){var i=n[s];i.subscriber&&i.observable.subscribe(i.subscriber)}},t.prototype.unsubscribe=function(t,r){if(e.prototype.unsubscribe.call(this,t,r),0===this.subscriberCount)for(var s=0,n=this.collections;s<n.length;s++){var i=n[s];i.subscriber&&i.observable.unsubscribe(i.subscriber)}},t.prototype.transformItems=function(e,t){var r;if(e)if(t){r=[];for(var s=0,n=e;s<n.length;s++){var i=t(n[s]);void 0!==i&&r.push(i)}}else r=e;else r=[];return r},t.prototype.getSubscriber=function(e,t){var r=this;return function(s){for(var n,i=s.index,o=0;o<e;o++)i+=r.collections[o].items.length;if(s.changedItems){var a=r.transformItems(s.changedItems,t);(n=r.items).splice.apply(n,[i,s.changedItems.length].concat(a)),r.notify({changedItems:a,index:i},"change")}else{var l=r.transformItems(s.removedItems,t),u=r.transformItems(s.addedItems,t);r.items.splice(i,l.length);for(var b=r.items.splice(i+l.length),c=0,h=u;c<h.length;c++){p=h[c];r.items.push(p)}for(var v=0,f=b;v<f.length;v++){var p=f[v];r.items.push(p)}r.notify({removedItems:l,addedItems:u,index:i},"splice")}}},t}(Observable);export{ObservableCollection};var ReadyableObservableArray=function(e){function t(t,r){void 0===t&&(t=[]),void 0===r&&(r=!1);var s=e.call(this,t)||this;return s.ready=new ObservableValue(r),s}return tslib_1.__extends(t,e),t}(ObservableArray);export{ReadyableObservableArray};export function useObservable(e){var t=React.useState(e)[0],r=React.useState(new ObservableValue(t));return[r[0],function(e){r[0].value="function"==typeof e?e(r[0].value):e}]};export function useObservableArray(e){var t=React.useState(e)[0],r=React.useState(new ObservableArray(t));return[r[0],function(e){r[0].value="function"==typeof e?e(r[0].value):e}]};